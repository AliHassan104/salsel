<div class="">
    <div class="card">
        <h1 class="mb-5"
            style="color: #93003c; font-size: 17.5px; font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif; font-weight: 700;">
            Create AWB</h1>
        <form action="" [formGroup]="awbForm" (ngSubmit)="onSubmit()">
            <div class="p-fluid p-formgrid grid">
                <!-- Shipper Details -->
                <!-- Account Number -->
                <div class="field col-12 md:col-6">
                    <label htmlFor="accountNumber">Account Number</label>
                    <p-dropdown [options]="preprocessedAccountNumbers" optionLabel="label"
                        placeholder="Select Account Number" filter="true" formControlName="accountNumber"
                        [ngClass]="{'ng-dirty':awbForm.get('accountNumber')?.touched && awbForm.get('accountNumber')?.invalid}"
                        [required]="true"></p-dropdown>
                    <small *ngIf="!awbForm.get('accountNumber')?.valid && awbForm.get('accountNumber')?.touched"
                        class="text-red-500">
                        Required
                    </small>
                </div>
                <!-- Shipper Name -->
                <div class="field col-12 md:col-6">
                    <label htmlFor="shippername">Shipper Name <img (click)="onAutoFillShipperDetails()" pTooltip="AutoFill Shipper Details From Address Book" tooltipPosition="top" src="../../../../assets/idea.png" class="ideaImg"></label>
                    <input pInputText id="shippername" type="text" formControlName="shipperName"
                        placeholder="Enter Shipper Name" />
                </div>
                <!-- Shipper Contact -->
                <div class="field col-12 md:col-6">
                    <label htmlFor="contact">Contact Number</label>
                    <input pInputText id="shipperContact" type="text" formControlName="shipperContactNumber"
                        placeholder="Enter Shipper Contact" />
                </div>
                <!-- Pickup Address -->
                <div class="field col-12 md:col-6">
                    <label htmlFor="address">Pickup Address</label>
                    <input pInputTextarea id="address" rows="4" formControlName="pickupAddress"
                        placeholder="Enter Pickup Address" />
                </div>
                <!-- Street Name -->
                <div class="field col-12 md:col-3">
                    <label htmlFor="deliveryStreetName">Street Name</label>
                    <input pInputTextarea id="pickupStreetName" rows="4" formControlName="pickupStreetName"
                        placeholder="Enter Street Name" />
                </div>
                <!-- District Address -->
                <div class="field col-12 md:col-3">
                    <label htmlFor="pickupDistrict">District</label>
                    <input pInputTextarea id="pickupDistrict" rows="4" formControlName="pickupDistrict"
                        placeholder="Enter District" />
                </div>
                <!-- Shipper Ref Number -->
                <div class="field col-12 md:col-6">
                    <label htmlFor="shipperRef">Shipper Ref Number</label>
                    <input pInputText id="shipperRef" type="text" formControlName="shipperRefNumber"
                        placeholder="Enter Shipper Ref Number" />
                </div>
                <!-- Origin Country -->
                <div class="field col-12 md:col-3">
                    <label htmlFor="ocountry">Origin Country</label>
                    <p-dropdown #dropdown [options]="countries" placeholder="Select Country"
                        formControlName="originCountry" filter="true"
                        (onChange)="getOriginCountry($event)"></p-dropdown>
                </div>
                <!-- Origin City -->
                <div class="field col-12 md:col-3">
                    <label htmlFor="oCity">Origin City</label>
                    <p-dropdown #dropdown1 [options]="originCities" placeholder="Enter city" filter="true"
                        formControlName="originCity"></p-dropdown>
                </div>
                <!-- Recipients Details -->
                <!-- Recipient Name -->
                <div class="field col-12 md:col-6">
                    <label htmlFor="recipientname">Recipient Name <img (click)="onAutoFillRecipientsDetails()" pTooltip="AutoFill Recipient Details From Address Book" tooltipPosition="top"
                        src="../../../../assets/idea.png" class="ideaImg"></label>
                    <input pInputText id="recipientname" type="text" formControlName="recipientsName"
                        placeholder="Enter Recipient Name" />
                </div>
                <!-- Recipient Contact Number -->
                <div class="field col-12 md:col-6">
                    <label htmlFor="contactR">Contact Number</label>
                    <input pInputText id="recipientsContact" type="text" formControlName="recipientsContactNumber"
                        placeholder="Enter Recipient Contact" />
                </div>
                <!-- Delivery Address -->
                <div class="field col-12 md:col-6">
                    <label htmlFor="daddress">Delivery Address</label>
                    <input pInputTextarea id="daddress" rows="4" formControlName="deliveryAddress"
                        placeholder="Enter Delivery Address" />
                </div>
                <!-- Street Name -->
                <div class="field col-12 md:col-3">
                    <label htmlFor="deliveryStreetName">Street Name</label>
                    <input pInputTextarea id="deliveryStreetName" rows="4" formControlName="deliveryStreetName"
                        placeholder="Enter Street Name" />
                </div>
                <!-- District Address -->
                <div class="field col-12 md:col-3">
                    <label htmlFor="deliveryDistrict">District</label>
                    <input pInputTextarea id="deliveryDistrict" rows="4" formControlName="deliveryDistrict"
                        placeholder="Enter District" />
                </div>
                <!-- Destination Country -->
                <div class="field col-12 md:col-3">
                    <label htmlFor="dcountry">Destination Country</label>
                    <p-dropdown #dropdown2 [options]="countries" placeholder="Select Country"
                        formControlName="destinationCountry" filter="true"
                        (onChange)="getDestinationCountry($event)"></p-dropdown>
                </div>
                <!-- Destination City -->
                <div class="field col-12 md:col-3">
                    <label htmlFor="dcity">Destination City</label>
                    <p-dropdown #dropdown3 [options]="destinationCities" placeholder="Select city" filter="true"
                        formControlName="destinationCity"></p-dropdown>
                </div>
                <!-- Pickup Date -->
                <div class="field col-12 md:col-6">
                    <label htmlFor="dcity">Pickup Date</label>
                    <p-calendar dateFormat="yy-mm-dd" [showIcon]="true" formControlName="pickupDate"
                        placeholder="Select Pickup Date"
                        [ngClass]="{'ng-dirty':awbForm.get('pickupDate')?.touched && awbForm.get('pickupDate')?.invalid}"></p-calendar>
                    <small *ngIf="!awbForm.get('pickupDate')?.valid && awbForm.get('pickupDate')?.touched"
                        class="text-red-500">
                        Required
                    </small>
                </div>
                <!-- Pickup Time -->
                <div class="field col-12 md:col-6">
                    <label htmlFor="dcity">Pickup Time</label>
                    <p-calendar [hourFormat]="24" [timeOnly]="true" formControlName="pickupTime" [showSeconds]="true"
                        [ngClass]="{'ng-dirty':awbForm.get('pickupTime')?.touched && awbForm.get('pickupTime')?.invalid}"
                        placeholder="Select Pickup Time" [required]="true"></p-calendar>
                    <small *ngIf="!awbForm.get('pickupTime')?.valid && awbForm.get('pickupTime')?.touched"
                        class="text-red-500">
                        Required
                    </small>
                </div>
                <!-- Product Type -->
                <div class="field col-12 md:col-3">
                    <label htmlFor="producttype">Product Type</label>
                    <p-dropdown [options]="productType" placeholder="Select Product Type" formControlName="productType"
                        [ngClass]="{'ng-dirty':awbForm.get('productType')?.touched && awbForm.get('productType')?.invalid}"
                        [required]="true" (onChange)="getProductType($event)"></p-dropdown>
                    <small *ngIf="!awbForm.get('productType')?.valid && awbForm.get('productType')?.touched"
                        class="text-red-500">
                        Required
                    </small>
                </div>
                <!-- Service Type -->
                <div class="field col-12 md:col-3">
                    <label htmlFor="servicetype">Service Type</label>
                    <p-dropdown [options]="serviceType" placeholder="Select Service Type" formControlName="serviceType"
                        [ngClass]="{'ng-dirty':awbForm.get('serviceType')?.touched && awbForm.get('serviceType')?.invalid}"
                        (onChange)="getServiceType($event)" [required]="true"></p-dropdown>
                    <small *ngIf="!awbForm.get('serviceType')?.valid && awbForm.get('serviceType')?.touched"
                        class="text-red-500">
                        Required
                    </small>
                </div>
                <!-- Pieces -->
                <div class="field col-12 md:col-3">
                    <label htmlFor="pieces">Pieces</label>
                    <input pInputText id="pieces" type="number" formControlName="pieces"
                        [ngClass]="{'ng-dirty':awbForm.get('pieces')?.touched && awbForm.get('pieces')?.invalid}"
                        placeholder="Enter Pieces" [required]="true" />
                    <small *ngIf="!awbForm.get('pieces')?.valid && awbForm.get('pieces')?.touched" class="text-red-500">
                        Required
                    </small>
                </div>
                <!-- Weight -->
                <div class="field col-12 md:col-3">
                    <label htmlFor="weight">Weight</label>
                    <input pInputText id="weight" type="text" formControlName="weight"
                        [ngClass]="{'ng-dirty':awbForm.get('weight')?.touched && awbForm.get('weight')?.invalid}"
                        placeholder="Enter Weight" [required]="true" />
                    <small *ngIf="!awbForm.get('weight')?.valid && awbForm.get('weight')?.touched" class="text-red-500">
                        Required
                    </small>
                </div>
                <!-- Content -->
                <div class="field col-12 md:col-6">
                    <label htmlFor="content">Content</label>
                    <input pInputText id="content" type="text" formControlName="content"
                        [ngClass]="{'ng-dirty':awbForm.get('content')?.touched && awbForm.get('content')?.invalid}"
                        placeholder="Enter Content" [required]="true" />
                    <small *ngIf="!awbForm.get('content')?.valid && awbForm.get('content')?.touched"
                        class="text-red-500">
                        Required
                    </small>
                </div>
                <!-- Currency -->
                <div class="field col-12 md:col-3">
                    <label htmlFor="currency">Currency</label>
                    <p-dropdown [options]="currencies" class="w-4" formControlName="currency"
                        placeholder="Select a currency"
                        [ngClass]="{'ng-dirty':awbForm.get('currency')?.touched && awbForm.get('currency')?.invalid}"
                        [required]="true"></p-dropdown>
                    <small *ngIf="!awbForm.get('currency')?.valid && awbForm.get('currency')?.touched"
                        class="text-red-500">
                        Required
                    </small>
                </div>
                <!-- Amount -->
                <div class="field col-12 md:col-3">
                    <label htmlFor="amount">Amount</label>
                    <p-inputNumber mode="decimal" inputId="withoutgrouping" [useGrouping]="false"
                        placeholder="Enter Amount" formControlName="amount"
                        [ngClass]="{'ng-dirty':awbForm.get('amount')?.touched && awbForm.get('amount')?.invalid}"
                        [required]="true">
                    </p-inputNumber>
                    <small *ngIf="!awbForm.get('amount')?.valid && awbForm.get('amount')?.touched" class="text-red-500">
                        Required
                    </small>
                </div>

                <!-- Duty & Taxes Bill To -->
                <div class="field col-12 md:col-6">
                    <label htmlFor="dutytaxes">Duty and Taxes Bill To</label>
                    <p-dropdown [options]="dutyTaxes" placeholder="Select Billing to"
                        formControlName="dutyAndTaxesBillTo"
                        [ngClass]="{'ng-dirty':awbForm.get('dutyAndTaxesBillTo')?.touched && awbForm.get('dutyAndTaxesBillTo')?.invalid}"
                        [required]="true"></p-dropdown>
                    <small
                        *ngIf="!awbForm.get('dutyAndTaxesBillTo')?.valid && awbForm.get('dutyAndTaxesBillTo')?.touched"
                        class="text-red-500">
                        Required
                    </small>
                </div>
                <!-- Request Type -->
                <div class="field col-12 md:col-6">
                    <label htmlFor="requesttype">Request Type</label>
                    <p-dropdown [options]="requestTypes" placeholder="Select Request Type" formControlName="requestType"
                        [ngClass]="{'ng-dirty':awbForm.get('requestType')?.touched && awbForm.get('requestType')?.invalid}"
                        [required]="true"></p-dropdown>
                    <small *ngIf="!awbForm.get('requestType')?.valid && awbForm.get('requestType')?.touched"
                        class="text-red-500">
                        Required
                    </small>
                </div>

                <div class="flex justify-content-end w-full">
                    <button pButton label="Create" type="Submit" class="mx-3 submit-btn"></button>
                </div>
            </div>
        </form>
    </div>
</div>


<p-toast [breakpoints]="{'920px': {width: '100%', right: '0', left: '0'}}"></p-toast>


        <p-dialog [header]="addressType? 'Select Shipper Details' : 'Select Recipient Details'" [(visible)]="visible" [modal]="true" [style]="{ width: '80vw' }"
            class="customDialogExcel" [draggable]="false" [resizable]="false">
            <p-table #dt1 [value]="addressBooks" dataKey="id" [rows]="5" [loading]="loading" [rowHover]="true"
                styleClass="p-datatable-gridlines" [paginator]="true"
                [globalFilterFields]="['name','contactNumber','country','city','userType','address','streetName','district']"
                responsiveLayout="scroll">
                <ng-template pTemplate="caption">
                    <div class="flex justify-content-between flex-column sm:flex-row">
                        <div class="mb-2">
                            <button pButton label="Clear" class="p-button-outlined" icon="pi pi-filter-slash"
                                (click)="clear(dt1)"></button>
                        </div>
            
                        <span class="p-input-icon-left mb-2">
                            <i class="pi pi-search"></i>
                            <input pInputText type="text" #filter (input)="onGlobalFilter(dt1, $event)" placeholder="Search Keyword"
                                class="w-full" />
                        </span>
                    </div>
                </ng-template>
            
                <ng-template pTemplate="header">
                    <tr>
                        <th style="min-width: 6rem">
                            <div class="flex justify-content-center align-items-center">
                                Actions
                            </div>
                        </th>
            
                        <th style="min-width: 10rem">
                            <div class="flex justify-content-center align-items-center">
                                Name
                            </div>
                        </th>
                        <th style="min-width: 10rem">
                            <div class="flex justify-content-center align-items-center">
                                Contact Number
                            </div>
                        </th>
                        <th style="min-width: 10rem">
                            <div class="flex justify-content-center align-items-center">
                                UserType
                            </div>
                        </th>
            
                        <th style="min-width: 10rem">
                            <div class="flex justify-content-center align-items-center">
                                Address
                            </div>
                        </th>
                        <th style="min-width: 10rem">
                            <div class="flex justify-content-center align-items-center">
                                Street Name
                            </div>
                        </th>
                        <th style="min-width: 10rem">
                            <div class="flex justify-content-center align-items-center">
                                District
                            </div>
                        </th>
                        <th style="min-width: 10rem">
                            <div class="flex justify-content-center align-items-center">
                                City
                            </div>
                        </th>
                        <th style="min-width: 10rem">
                            <div class="flex justify-content-center align-items-center">
                                Country
                            </div>
                        </th>
            
            
                    </tr>
                </ng-template>
                <ng-template pTemplate="body" let-addressBook>
                    <tr>
                        <td>
                            <button *ngIf="tooltipVisible" pTooltip="Select" tooltipPosition="bottom" pButton pRipple type="button"
                                icon="pi pi-thumbs-up-fill" class="p-button-rounded p-button-secondary p-button-outlined mx-2"
                                (click)="onSelectShipperAddress(addressBook?.id)" appendTo="body"></button>
            
                        </td>
                        <td>
                            {{addressBook?.name}}
                        </td>
                        <td>
                            {{addressBook?.contactNumber}}
                        </td>
                        <td>
                            {{addressBook?.userType}}
                        </td>
                        <td>
                            {{addressBook?.address}}
                        </td>
                        <td>
                            {{addressBook?.streetName}}
                        </td>
                        <td>
                            {{addressBook?.district}}
                        </td>
                        <td>
                            {{addressBook?.city}}
                        </td>
                        <td>
                            {{addressBook?.country}}
                        </td>
            
            
            
                    </tr>
                </ng-template>
                <ng-template pTemplate="emptymessage">
                    <tr>
                        <td style="text-align: start !important;" colspan="8">No Address
                            found.</td>
                    </tr>
                </ng-template>
                <ng-template pTemplate="loadingbody">
                    <tr>
                        <td style="text-align: start !important;" colspan="8">Loading Address Book Data. Please
                            wait.</td>
                    </tr>
                </ng-template>
            </p-table>
        </p-dialog>

            <p-dialog [(visible)]="addressDialog" header="Confirm" [modal]="true" [style]="{width:'450px'}">
                <div class="flex align-items-center justify-content-center">
                    <i class="pi pi-exclamation-triangle mr-3" style="font-size: 2rem"></i>
                    <span *ngIf="addressBookStatus === 'Not Exist'">
                    Would you like to save recipient and shipper details to the address book?
                    </span>
                    <span *ngIf="addressBookStatus === 'recipient'">
                        Would you like to save shipper details to the address book?
                    </span>
                    <span *ngIf="addressBookStatus === 'shipper'">
                        Would you like to save recipient details to the address book?
                    </span>
                </div>
                <ng-template pTemplate="footer">
                    <button pButton pRipple icon="pi pi-times" class="p-button-text" label="No"
                        (click)="onCancelAddressRequest()"></button>
                    <button pButton pRipple icon="pi pi-check" class="p-button-text" label="Yes"
                        (click)="confirmCreateAddress()"></button>
                </ng-template>
            </p-dialog>

